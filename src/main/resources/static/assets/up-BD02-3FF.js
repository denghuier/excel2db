import{q as ye,d as be,r as ne,l as Le,f as I,w as V,i as ie,k as G,t as Fe,F as Ee,b as Z,e as je,j as $e,g as se}from"./index-DUUratVh.js";var Se={exports:{}};(function(o){var i=function(s){var c=Object.prototype,u=c.hasOwnProperty,f=Object.defineProperty||function(t,e,r){t[e]=r.value},a,d=typeof Symbol=="function"?Symbol:{},m=d.iterator||"@@iterator",S=d.asyncIterator||"@@asyncIterator",_=d.toStringTag||"@@toStringTag";function g(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{g({},"")}catch{g=function(e,r,l){return e[r]=l}}function P(t,e,r,l){var n=e&&e.prototype instanceof h?e:h,p=Object.create(n.prototype),y=new Y(l||[]);return f(p,"_invoke",{value:ve(t,r,y)}),p}s.wrap=P;function j(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(l){return{type:"throw",arg:l}}}var z="suspendedStart",M="suspendedYield",W="executing",R="completed",F={};function h(){}function w(){}function v(){}var k={};g(k,m,function(){return this});var $=Object.getPrototypeOf,A=$&&$($(H([])));A&&A!==c&&u.call(A,m)&&(k=A);var B=v.prototype=h.prototype=Object.create(k);w.prototype=v,f(B,"constructor",{value:v,configurable:!0}),f(v,"constructor",{value:w,configurable:!0}),w.displayName=g(v,_,"GeneratorFunction");function te(t){["next","throw","return"].forEach(function(e){g(t,e,function(r){return this._invoke(e,r)})})}s.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===w||(e.displayName||e.name)==="GeneratorFunction":!1},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,g(t,_,"GeneratorFunction")),t.prototype=Object.create(B),t},s.awrap=function(t){return{__await:t}};function D(t,e){function r(p,y,b,E){var L=j(t[p],t,y);if(L.type==="throw")E(L.arg);else{var J=L.arg,N=J.value;return N&&typeof N=="object"&&u.call(N,"__await")?e.resolve(N.__await).then(function(U){r("next",U,b,E)},function(U){r("throw",U,b,E)}):e.resolve(N).then(function(U){J.value=U,b(J)},function(U){return r("throw",U,b,E)})}}var l;function n(p,y){function b(){return new e(function(E,L){r(p,y,E,L)})}return l=l?l.then(b,b):b()}f(this,"_invoke",{value:n})}te(D.prototype),g(D.prototype,S,function(){return this}),s.AsyncIterator=D,s.async=function(t,e,r,l,n){n===void 0&&(n=Promise);var p=new D(P(t,e,r,l),n);return s.isGeneratorFunction(e)?p:p.next().then(function(y){return y.done?y.value:p.next()})};function ve(t,e,r){var l=z;return function(p,y){if(l===W)throw new Error("Generator is already running");if(l===R){if(p==="throw")throw y;return oe()}for(r.method=p,r.arg=y;;){var b=r.delegate;if(b){var E=re(b,r);if(E){if(E===F)continue;return E}}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(l===z)throw l=R,r.arg;r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);l=W;var L=j(t,e,r);if(L.type==="normal"){if(l=r.done?R:M,L.arg===F)continue;return{value:L.arg,done:r.done}}else L.type==="throw"&&(l=R,r.method="throw",r.arg=L.arg)}}}function re(t,e){var r=e.method,l=t.iterator[r];if(l===a)return e.delegate=null,r==="throw"&&t.iterator.return&&(e.method="return",e.arg=a,re(t,e),e.method==="throw")||r!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),F;var n=j(l,t.iterator,e.arg);if(n.type==="throw")return e.method="throw",e.arg=n.arg,e.delegate=null,F;var p=n.arg;if(!p)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,F;if(p.done)e[t.resultName]=p.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=a);else return p;return e.delegate=null,F}te(B),g(B,_,"Generator"),g(B,m,function(){return this}),g(B,"toString",function(){return"[object Generator]"});function we(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function q(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Y(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(we,this),this.reset(!0)}s.keys=function(t){var e=Object(t),r=[];for(var l in e)r.push(l);return r.reverse(),function n(){for(;r.length;){var p=r.pop();if(p in e)return n.value=p,n.done=!1,n}return n.done=!0,n}};function H(t){if(t){var e=t[m];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var r=-1,l=function n(){for(;++r<t.length;)if(u.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=a,n.done=!0,n};return l.next=l}}return{next:oe}}s.values=H;function oe(){return{value:a,done:!0}}return Y.prototype={constructor:Y,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(q),!t)for(var e in this)e.charAt(0)==="t"&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=a)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(E,L){return p.type="throw",p.arg=t,e.next=E,L&&(e.method="next",e.arg=a),!!L}for(var l=this.tryEntries.length-1;l>=0;--l){var n=this.tryEntries[l],p=n.completion;if(n.tryLoc==="root")return r("end");if(n.tryLoc<=this.prev){var y=u.call(n,"catchLoc"),b=u.call(n,"finallyLoc");if(y&&b){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(y){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else if(b){if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var l=this.tryEntries[r];if(l.tryLoc<=this.prev&&u.call(l,"finallyLoc")&&this.prev<l.finallyLoc){var n=l;break}}n&&(t==="break"||t==="continue")&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var p=n?n.completion:{};return p.type=t,p.arg=e,n?(this.method="next",this.next=n.finallyLoc,F):this.complete(p)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),F},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),q(r),F}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var l=r.completion;if(l.type==="throw"){var n=l.arg;q(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:H(t),resultName:e,nextLoc:r},this.method==="next"&&(this.arg=a),F}},s}(o.exports);try{regeneratorRuntime=i}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}})(Se);var _e={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}};let ee=!1,ue=()=>{};const ke=o=>{ee=o},Oe=o=>{ue=o},Pe=(o,i)=>{ue({type:o,message:i}),ee&&console.log(`[${o}] ${i}`)};var pe={logging:ee,setLogging:ke,setCustomLogger:Oe,log:Pe};let T=0,K=0;const ae=o=>{const[i,s,c]=o.split(":");return parseFloat(i)*60*60+parseFloat(s)*60+parseFloat(c)};var Ue=(o,i)=>{if(typeof o=="string")if(o.startsWith("  Duration")){const s=o.split(", ")[0].split(": ")[1],c=ae(s);i({duration:c,ratio:K}),(T===0||T>c)&&(T=c)}else if(o.startsWith("frame")||o.startsWith("size")){const s=o.split("time=")[1].split(" ")[0],c=ae(s);K=c/T,i({ratio:K,time:c})}else o.startsWith("video:")&&(i({ratio:1}),T=0)},Ce=(o,i)=>{const s=o._malloc(i.length*Uint32Array.BYTES_PER_ELEMENT);return i.forEach((c,u)=>{const f=o._malloc(c.length+1);o.writeAsciiToMemory(c,f),o.setValue(s+Uint32Array.BYTES_PER_ELEMENT*u,f,"i32")}),[i.length,s]},de={exports:{}};(function(o,i){(function(s,c){o.exports=c()})(ye,function(){function s(){var c=arguments.length;if(c===0)throw new Error("resolveUrl requires at least one argument; got none.");var u=document.createElement("base");if(u.href=arguments[0],c===1)return u.href;var f=document.getElementsByTagName("head")[0];f.insertBefore(u,f.firstChild);for(var a=document.createElement("a"),d,m=1;m<c;m++)a.href=arguments[m],d=a.href,u.href=d;return f.removeChild(u),d}return s})})(de);var he=de.exports;const Re="@ffmpeg/ffmpeg",Ae="0.10.1",Be="FFmpeg WebAssembly version",Ge="src/index.js",Ne="src/index.d.ts",Te={example:"examples"},xe={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},ze={"./src/node/index.js":"./src/browser/index.js"},We={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},De=["ffmpeg","WebAssembly","video"],Ie="Jerome Wu <jeromewus@gmail.com>",Ve="MIT",Me={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},qe={node:">=12.16.1"},Ye="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",He={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},Je={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.10.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"},me={name:Re,version:Ae,description:Be,main:Ge,types:Ne,directories:Te,scripts:xe,browser:ze,repository:We,keywords:De,author:Ie,license:Ve,bugs:Me,engines:qe,homepage:Ye,dependencies:He,devDependencies:Je},{devDependencies:Ze}=me;var Ke={corePath:`https://unpkg.com/@ffmpeg/core@${Ze["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`};const Qe=he,{log:x}=pe,Q=async(o,i)=>{x("info",`fetch ${o}`);const s=await(await fetch(o)).arrayBuffer();x("info",`${o} file size = ${s.byteLength} bytes`);const c=new Blob([s],{type:i}),u=URL.createObjectURL(c);return x("info",`${o} blob URL = ${u}`),u};var Xe=async({corePath:o})=>{if(typeof o!="string")throw Error("corePath should be a string!");const i=Qe(o),s=await Q(i,"application/javascript"),c=await Q(i.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),u=await Q(i.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore>"u"?new Promise(f=>{const a=document.createElement("script"),d=()=>{a.removeEventListener("load",d),x("info","ffmpeg-core.js script loaded"),f({createFFmpegCore,corePath:s,wasmPath:c,workerPath:u})};a.src=s,a.type="text/javascript",a.addEventListener("load",d),document.getElementsByTagName("head")[0].appendChild(a)}):(x("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:s,wasmPath:c,workerPath:u}))};const et=he,tt=o=>new Promise((i,s)=>{const c=new FileReader;c.onload=()=>{i(c.result)},c.onerror=({target:{error:{code:u}}})=>{s(Error(`File could not be read! Code=${u}`))},c.readAsArrayBuffer(o)});var rt=async o=>{let i=o;return typeof o>"u"?new Uint8Array:(typeof o=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(o)?i=atob(o.split(",")[1]).split("").map(s=>s.charCodeAt(0)):i=await(await fetch(et(o))).arrayBuffer():(o instanceof File||o instanceof Blob)&&(i=await tt(o)),new Uint8Array(i))};const ot=Ke,nt=Xe,it=rt;var ge={defaultOptions:ot,getCreateFFmpegCore:nt,fetchFile:it};const{defaultArgs:st,baseOptions:at}=_e,{setLogging:le,setCustomLogger:ce,log:C}=pe,lt=Ue,ct=Ce,{defaultOptions:ft,getCreateFFmpegCore:ut}=ge,{version:pt}=me,X=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var dt=(o={})=>{const{log:i,logger:s,progress:c,...u}={...at,...ft,...o};let f=null,a=null,d=null,m=!1,S=c;const _=h=>{h==="FFMPEG_END"&&d!==null&&(d(),d=null,m=!1)},g=({type:h,message:w})=>{C(h,w),lt(w,S),_(w)},P=async()=>{if(C("info","load ffmpeg-core"),f===null){C("info","loading ffmpeg-core");const{createFFmpegCore:h,corePath:w,workerPath:v,wasmPath:k}=await ut(u);f=await h({mainScriptUrlOrBlob:w,printErr:$=>g({type:"fferr",message:$}),print:$=>g({type:"ffout",message:$}),locateFile:($,A)=>{if(typeof window<"u"){if(typeof k<"u"&&$.endsWith("ffmpeg-core.wasm"))return k;if(typeof v<"u"&&$.endsWith("ffmpeg-core.worker.js"))return v}return A+$}}),a=f.cwrap("proxy_main","number",["number","number"]),C("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},j=()=>f!==null,z=(...h)=>{if(C("info",`run ffmpeg command: ${h.join(" ")}`),f===null)throw X;if(m)throw Error("ffmpeg.wasm can only run one command at a time");return m=!0,new Promise(w=>{const v=[...st,...h].filter(k=>k.length!==0);d=w,a(...ct(f,v))})},M=(h,...w)=>{if(C("info",`run FS.${h} ${w.map(v=>typeof v=="string"?v:`<${v.length} bytes binary file>`).join(" ")}`),f===null)throw X;{let v=null;try{v=f.FS[h](...w)}catch{throw Error(h==="readdir"?`ffmpeg.FS('readdir', '${w[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:h==="readFile"?`ffmpeg.FS('readFile', '${w[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return v}},W=()=>{if(f===null)throw X;m=!1,f.exit(1),f=null,a=null,d=null},R=h=>{S=h},F=h=>{ce(h)};return le(i),ce(s),C("info",`use ffmpeg.wasm v${pt}`),{setProgress:R,setLogger:F,setLogging:le,load:P,isLoaded:j,run:z,exit:W,FS:M}};const ht=dt,{fetchFile:mt}=ge;var fe={createFFmpeg:ht,fetchFile:mt};let O={};O.squeezVideo=async function(o,i,s,c,u,f){console.log("file",o),console.log("filename",i),console.log("filetype",s),console.log("width",c),console.log("height",u);const a=fe.createFFmpeg({corePath:"ffmpeg-core.js",log:!0,progress:({ratio:g})=>{f.value=`完成率: ${(g*100).toFixed(1)}%`}});var{name:d}=o;await a.load(),a.FS("writeFile",d,await fe.fetchFile(o));const m=this.computeFileSize(o);console.log("After compression,this file size is "+m+" 字节."),await a.run("-i",d,"-c:v","libx264","-vf","scale=240:320","-r","24","-crf","50","-threads","4","-preset","ultrafast","output.mp4");const S=a.FS("readFile","output.mp4"),_=new Blob([S],{type:"text/plain;charset=utf-8"});return new Promise((g,P)=>{const j=new window.File([_],i,{type:s});console.log(j.size),g(j)})};O.computeFileSize=function(o){return o?o.size/1024/1024>60?"31457280":o.size/1024/1024<=60&&o.size/1024/1024>30?o.size/2:o.size:"0"};O.getObjectURL=function(o){let i=null;return window.URL=window.URL||window.webkitURL,window.URL?i=window.URL.createObjectURL(o):i=URL.createObjectURL(o),i};O.getVideoData=function(){return new Promise((o,i)=>{document.getElementById("video").addEventListener("loadedmetadata",function(){o({width:this.videoWidth,height:this.videoHeight,duration:this.duration})})})};const gt=["href"],wt=be({__name:"up",setup(o){const i=ne(""),s=ne(""),c=f=>{i.value="请稍等，过大的视频正在压缩上传中...";let a=f.name,d=f.type;const m=O.getObjectURL(f),S=document.getElementById("video");S.src=m,O.getVideoData().then(_=>{const{width:g,height:P}=_,j=O.squeezVideo(f,a,d,g,P,i);return console.log(j),j})},u=f=>{};return(f,a)=>{const d=Z("el-icon"),m=Z("el-upload"),S=Z("el-button");return je(),Le(Ee,null,[I(m,{style:{width:"100%"},drag:"",action:"/dev-api/excel/video","on-success":u,"before-upload":c,multiple:""},{tip:V(()=>a[1]||(a[1]=[G("div",{class:"el-upload__tip"}," 上传excel 文件 ",-1)])),default:V(()=>[I(d,{class:"el-icon--upload"},{default:V(()=>[I(ie($e))]),_:1}),a[2]||(a[2]=G("div",{class:"el-upload__text"},[se(" 拖拽 或者 "),G("em",null,"点击上传")],-1))]),_:1}),I(S,{onClick:a[0]||(a[0]=_=>ie(O).run())},{default:V(()=>a[3]||(a[3]=[se("执行")])),_:1}),G("p",null,Fe(i.value),1),G("a",{href:s.value,download:"video.mp4"},"下载视频",8,gt),a[4]||(a[4]=G("video",{id:"video",autoplay:"autoplay",loop:"",controls:""},null,-1))],64)}}});export{wt as default};
